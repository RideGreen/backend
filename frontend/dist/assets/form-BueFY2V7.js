import{u as $,b as o,o as P,d as S,j as e,L as z,e as C}from"./index-D14RG33K.js";const H=()=>{const f=$(),[i,D]=o.useState(1),[n,l]=o.useState({departure:"",destination:"",seats:1,price:0,date:new Date,time:"",vehicleType:"",vehicleDetails:"",instantBooking:!1}),[u,L]=o.useState(null),[B,T]=o.useState(!0);o.useEffect(()=>{const t=P(S,r=>{L(r),T(!1)});return()=>t()},[S]),o.useEffect(()=>{if(!u){const t=setTimeout(()=>{f("/login")},1e4);return()=>clearTimeout(t)}},[u,f]);const b=new Date().toISOString().split("T")[0],E="https://ridegreen.onrender.com",p=t=>{const{name:r,value:a}=t.target;if(l({...n,[r]:a}),r==="date")if(n.date===b){const s=new Date().toTimeString().split(" ")[0].slice(0,5);document.getElementById("time").setAttribute("min",s)}else document.getElementById("time").removeAttribute("min")},F=()=>{l({...n,instantBooking:!n.instantBooking})},[g]=o.useState(["Bangalore","Mysore","Mangalore","Hubli","Belgaum","Shimoga","Davanagere","Gulbarga","Bellary","Tumkur","Udupi","Bijapur","Mandya","Raichur","Ramanagara","Shivamogga","Udupi"]),[q,I]=o.useState(g),[A,v]=o.useState(g),[d,m]=o.useState({departure:!1,destination:!1});o.useEffect(()=>{const t=r=>{r.target.closest(".dropdown-container")||m({departure:!1,destination:!1})};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const w=(t,r)=>{const a=t.target.value.toLowerCase();r==="departure"?(l({...n,departure:t.target.value}),I(g.filter(s=>s.toLowerCase().includes(a)))):r==="destination"&&(l({...n,destination:t.target.value}),v(g.filter(s=>s.toLowerCase().includes(a)&&s!==n.departure))),m({...d,[r]:!0})},j=(t,r)=>{t==="departure"?(l({...n,departure:r}),v(g.filter(a=>a!==r))):t==="destination"&&l({...n,destination:r}),m({...d,[t]:!1})},M=()=>i===1?n.departure&&n.destination:i===2?n.seats>0&&n.price>0:i===3?n.vehicleDetails.trim()!=="":!0,N=t=>{t.preventDefault(),M()?D(i+1):alert("Please fill all the required fields.")};async function O(t){t.preventDefault(),console.log("submit button clicked");const r=await y(n.departure),a=await y(n.destination);console.log(r," ",a);let s;r&&a&&(s=await R(r,a),console.log(s),l(c=>({...c})));try{(await fetch(`${E}/api/offer-ride`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,distance:parseFloat(s),email:u.email})})).ok?f("/offer-ride/publish"):alert("Failed to post the ride.")}catch(c){console.error("Error:",c),alert("An error occurred while posting the ride.")}console.log("rideData :",{...n,distance:parseFloat(s),email:u.email})}const y=async t=>{const r=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}`,s=await(await fetch(r)).json();if(s.length>0){const{lat:c,lon:h}=s[0];return console.log(c,": lat , lon :  ",h),{lat:c,lon:h}}else return console.error("Error fetching coordinates"),null},R=async(t,r)=>{const{lat:a,lon:s}=t,{lat:c,lon:h}=r,U=`http://router.project-osrm.org/route/v1/driving/${s},${a};${h},${c}?overview=false`,x=await(await fetch(U)).json();if(x.routes&&x.routes[0]){const k=(x.routes[0].legs[0].distance/1e3).toFixed(2);return console.log(k),k}else return console.error("Error calculating distance"),null};return B?e.jsx(z,{}):u?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 p-6",children:e.jsxs("form",{onSubmit:i===4?O:N,className:"bg-white p-8 rounded-lg shadow-lg w-full max-w-lg",children:[e.jsx(C,{to:"/",className:"flex flex-col items-center m-5",children:e.jsx("img",{src:"/main-logo.png",alt:"logo",className:"rounded-full h-12 justify-center"})}),e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-green-600",children:"Offer Ride"}),i===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 dropdown-container relative",children:[e.jsx("label",{className:"block text-gray-700",children:"Pick-up Location"}),e.jsx("input",{type:"text",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",placeholder:"Search pick-up location",value:n.departure,onClick:()=>m({...d,departure:!0,destination:!1}),onChange:t=>w(t,"departure"),required:!0}),d.departure&&e.jsx("div",{className:"absolute w-7/12 bg-white border rounded-lg mt-1 w-full max-h-40 overflow-auto z-10",children:q.map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-green-100 cursor-pointer",onClick:()=>j("departure",t),children:t},t))})]}),e.jsxs("div",{className:"mb-4 dropdown-container relative",children:[e.jsx("label",{className:"block text-gray-700",children:"Drop-off Location"}),e.jsx("input",{type:"text",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",placeholder:"Search drop-off location",value:n.destination,onClick:()=>m({...d,destination:!0,departure:!1}),onChange:t=>w(t,"destination"),required:!0}),d.destination&&e.jsx("div",{className:"absolute w-7/12 bg-white border rounded-lg mt-1 w-full max-h-40 overflow-auto z-10",children:A.map(t=>e.jsx("div",{className:"px-4 py-2 hover:bg-green-100 cursor-pointer",onClick:()=>j("destination",t),children:t},t))})]}),e.jsx("input",{type:"date",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",name:"date",min:b,onChange:p,required:!0}),e.jsx("input",{id:"time",type:"time",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",name:"time",min:n.date===b?new Date().toLocaleTimeString("en-US",{hour12:!1}).slice(0,5):"",onChange:p,required:!0}),e.jsx("button",{type:"submit",className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 mt-2",children:"Next"})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Seats Available"}),e.jsx("input",{type:"number",name:"seats",value:n.seats,onChange:t=>l({...n,seats:Number(t.target.value)}),min:"1",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Price per Seat"}),e.jsx("input",{type:"number",name:"price",value:n.price,onChange:t=>l({...n,price:Number(t.target.value)}),min:"50",className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200",children:"Next"})]}),i===3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Vehicle type"}),e.jsx("input",{type:"text",name:"vehicleType",value:n.vehicleType,onChange:p,className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",placeholder:"(eg., car,bike)",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Vehicle Name"}),e.jsx("input",{type:"text",name:"vehicleDetails",value:n.vehicleDetails,onChange:p,className:"w-full mt-2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600",placeholder:"(eg., MG hector,fortuner)",required:!0})]}),e.jsx("button",{type:"button",onClick:N,className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200",children:"Next"})]}),i===4&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("label",{className:"block text-gray-700 mr-3",children:"Instant Booking"}),e.jsxs("div",{className:"relative inline-block w-10 mr-2 align-middle select-none",children:[e.jsx("input",{type:"checkbox",name:"instantBooking",id:"instantBooking",checked:n.instantBooking,onChange:F,className:"checked:bg-green-600 outline-none focus:outline-none right-4 checked:right-0 duration-200 ease-in absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"}),e.jsx("label",{htmlFor:"instantBooking",className:"block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"})]})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"By enabling instant booking, passengers can immediately book a seat without waiting for your approval. Otherwise, each booking request will require your confirmation."}),e.jsx("button",{type:"submit",className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200",children:"Submit"})]})]})}):e.jsxs("div",{className:"flex-col content-center justify-items-center min-h-screen bg-gray-100 p-6",children:[e.jsxs("h1",{className:"text-green-900",children:["Please ",e.jsx(C,{to:"/login",className:"text-black underline",children:"login"})," before posting a ride"]}),e.jsx("h3",{className:"text-green-800",children:"You'll be redirected to login page in 1mins.."})]})};export{H as default};
